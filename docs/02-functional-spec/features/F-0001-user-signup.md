---
id: F-0001
title: ユーザーサインアップ
status: implemented
related:
  ui: [S-100]
  api: [POST /auth/signup]
updated: 2026-01-02
---

# F-0001: ユーザーサインアップ

## 概要

新規ユーザーがアカウントを作成し、専用のワークスペースを持って利用を開始できる機能。ユーザーはメールアドレス、パスワード、ワークスペース名を入力してサインアップを行い、自動的にログイン状態となってアプリケーションの利用を開始できます。

## ユーザーストーリー

### User Story 1 - 新規ユーザーアカウント作成とワークスペース (優先度: P1)

新規ユーザーがサインアップページを訪れ、メールアドレス、パスワード、ワークスペース名を入力してアカウントを作成します。システムはユーザーアカウントと指定された名前のワークスペースを作成し、自動的にログイン状態にしてトップページにリダイレクトします。

**なぜこの優先度か**: これはユーザー獲得を可能にするコア機能です。これがなければ新規ユーザーはプラットフォームに参加できません。ワークスペース名を最初から取得することで、ユーザーは最初からパーソナライズされた環境を持つことができます。

**独立したテスト**: サインアップページに移動し、有効な認証情報とワークスペース名を送信し、ユーザーが作成され、指定された名前のワークスペースが作成され、ログイン状態でトップページにリダイレクトされることを確認することで完全にテストできます。

**受け入れシナリオ**:

1. **Given** ユーザーがサインアップページにいる、**When** 有効なメールアドレス、パスワード、ワークスペース名を入力してフォームを送信する、**Then** 新しいユーザーアカウントが作成され、指定された名前のワークスペースが作成され、自動的にログインされ、トップページにリダイレクトされる
2. **Given** ユーザーがサインアップページにいる、**When** システムに既に存在するメールアドレスを入力する、**Then** メールアドレスが既に登録されていることを示すエラーメッセージが表示され、アカウントを作成できない
3. **Given** ユーザーがサインアップページにいる、**When** 無効なメールアドレス形式を入力する、**Then** メールアドレス形式が無効であることを示すエラーメッセージが表示される
4. **Given** ユーザーがサインアップページにいる、**When** 要件を満たさないパスワードを入力する、**Then** パスワード要件を示すエラーメッセージが表示される
5. **Given** ユーザーがサインアップページにいる、**When** ワークスペース名フィールドを空のままにする、**Then** ワークスペース名が必須であることを示すエラーメッセージが表示される

---

### User Story 2 - 安全なパスワード処理 (優先度: P2)

ユーザーは適切に検証され、安全に保存される安全なパスワードでアカウントを作成できます。これにより、作成時からアカウントのセキュリティが確保されます。

**なぜこの優先度か**: セキュリティは重要ですが、基本機能(P1)が最初に動作すべきです。これはその上にセキュリティレイヤーを追加します。

**独立したテスト**: さまざまなパスワードパターンでアカウント作成を試み、適切な検証と安全な保存（ハッシュ化され、平文でない）を確認することでテストできます。

**受け入れシナリオ**:

1. **Given** ユーザーがアカウントを作成している、**When** 8文字未満のパスワードを入力する、**Then** 最小8文字が必要であることを示すエラーメッセージが表示される
2. **Given** ユーザーがアカウントを正常に作成した、**When** データベースを確認する、**Then** パスワードはハッシュ形式で保存され、平文ではない
3. **Given** ユーザーがアカウントを作成している、**When** パスワードを入力する、**Then** パスワードフィールドはセキュリティのためマスクされた文字を表示する

---

### User Story 3 - メールアドレス一意性検証 (優先度: P2)

システムはアプリケーションとデータベースの両方のレベルでメールアドレスの一意性を強制し、重複アカウントを防止し、各メールアドレスが1つのアカウントにのみ関連付けられることを保証します。

**なぜこの優先度か**: これはアカウントセキュリティとログイン機能にとって重要です。データ整合性の問題を防ぐため、リリース前に実装する必要があります。

**独立したテスト**: 同じメールアドレスで複数のアカウントを作成しようとし、システムが一貫して重複を拒否することを確認することでテストできます。

**受け入れシナリオ**:

1. **Given** "test@example.com" のメールアドレスを持つユーザーが既に存在する、**When** 別のユーザーが "test@example.com" でサインアップしようとする、**Then** サインアップはエラーメッセージで拒否される
2. **Given** ユーザーがサインアップページにいる、**When** 既に存在するメールアドレスを入力する（"Test@Example.com" のように大文字小文字が異なっても）、**Then** システムは重複として扱いエラーを表示する
3. **Given** データベースにメールアドレスの一意制約がある、**When** 重複メールアドレスが同時に送信される、**Then** データベース制約が重複作成を防止する

---

### User Story 4 - ワークスペース名カスタマイズ (優先度: P3)

サインアップ時に、ユーザーはワークスペースの名前を提供し、最初からワークスペースの識別方法を制御できます。

**なぜこの優先度か**: ユーザーエクスペリエンスにとって重要ですが、コアサインアップフロー(P1)が最初に動作する必要があります。これはパーソナライゼーションを強化しますが、ブロッキングではありません。

**独立したテスト**: さまざまなワークスペース名でアカウントを作成し、名前が適切に保存および表示されることを確認することでテストできます。

**受け入れシナリオ**:

1. **Given** 新規ユーザーがワークスペース名 "My Project" でサインアップを完了する、**When** アカウントが作成される、**Then** "My Project" という名前のワークスペースが作成される
2. **Given** 新規ユーザーのワークスペースが作成された、**When** ユーザーがトップページにアクセスする、**Then** ワークスペース名が表示される
3. **Given** ユーザーが特殊文字や絵文字を含むワークスペース名を入力する、**When** フォームを送信する、**Then** ワークスペース名が適切に保存および表示される

---

### エッジケース

- ユーザーがサインアップフォームを素早く複数回送信した場合（ダブルクリック）はどうなるか？
- サインアップ処理中にネットワーク中断が発生した場合、システムはどう処理するか？
- ワークスペース作成が失敗したがユーザー作成が成功した場合はどうなるか？
- システムは非常に長いメールアドレス、パスワード、ワークスペース名をどう処理するか？
- フォームを完了する前にユーザーがサインアップページから離れた場合はどうなるか？
- システムは自動ボットサインアップをどう防止するか？
- 2人のユーザーが同時に同じメールアドレスで登録しようとした場合はどうなるか？
- システムは異なる大文字小文字のメールアドレスをどう処理するか（test@example.com vs Test@Example.com）？

## 機能要件

- **FR-001**: システムはメールアドレス、パスワード、ワークスペース名の入力フィールドを持つサインアップページを提供しなければならない
- **FR-002**: システムはサインアップを受け付ける前に適切な形式のメールアドレスを検証しなければならない
- **FR-003**: システムはメールアドレスの一意性を強制しなければならない - 各メールアドレスは1つのアカウントにのみ関連付けられる
- **FR-004**: システムは一意性チェックのためメールアドレスを大文字小文字を区別せずに扱わなければならない（test@example.com = Test@Example.com）
- **FR-005**: システムは重複アカウントを防ぐためメールフィールドにデータベース一意制約を持たなければならない
- **FR-006**: システムは最小セキュリティ要件（最低8文字）を満たすパスワードを検証しなければならない
- **FR-007**: システムは新しいアカウントを作成する前にメールアドレスが既に登録されているかチェックしなければならない
- **FR-008**: システムは提供されたメールアドレスとハッシュ化されたパスワードで新しいユーザーレコードを作成しなければならない
- **FR-009**: システムは新規ユーザーサインアップ時に自動的にワークスペースを作成しなければならない
- **FR-010**: システムはワークスペース作成時にユーザー提供のワークスペース名を使用しなければならない
- **FR-011**: システムは新しく作成されたワークスペースを新しいユーザーアカウントにリンクしなければならない
- **FR-012**: システムはサインアップ成功後に自動的にユーザーをログインさせなければならない
- **FR-013**: システムはサインアップとログイン成功後にユーザーをトップページにリダイレクトしなければならない
- **FR-014**: システムは検証失敗（重複メール、無効な形式、弱いパスワード、ワークスペース名の欠落）に対して適切なエラーメッセージを表示しなければならない
- **FR-015**: システムは不完全なフォーム（メール、パスワード、ワークスペース名の欠落）の送信を防止しなければならない
- **FR-016**: システムはパスワードをハッシュ形式で保存し、決して平文で保存してはならない
- **FR-017**: システムはサインアッププロセス中に視覚的なフィードバック（ローディング状態、成功/エラーメッセージ）を提供しなければならない
- **FR-018**: システムはワークスペース名が空でないことを検証しなければならない

## 主要エンティティ

- **User（ユーザー）**: システムにアカウントを持つ人を表します。主な属性には、ログインの一意の識別子であるメール（全ユーザーで一意でなければならない）、認証用のハッシュ化されたパスワード、作成タイムスタンプが含まれます。メールの一意性はアプリケーションとデータベースの両方のレベルで強制されます。

- **Workspace（ワークスペース）**: ユーザーまたはチームの隔離された環境を表します。各ワークスペースはユーザーにリンクされ、作業のコンテキストとして機能します。主な属性には、ワークスペース名（サインアップ時にユーザー提供）、所有者/作成者、作成タイムスタンプが含まれます。

- **User-Workspace Relationship（ユーザー・ワークスペース関係）**: ユーザーをワークスペースにリンクします。サインアップフローでは、各新規ユーザーは提供したワークスペース名を使用して自動的に作成され、アカウントに関連付けられた1つのワークスペースを取得します。

## 成功基準

- **SC-001**: 新規ユーザーは通常の条件下で、サインアッププロセス全体（フォーム送信からトップページへのログインまで）を30秒以内に完了できる
- **SC-002**: システムは、大文字小文字のみが異なる場合を含め、同じメールアドレスの重複アカウント作成を100%の確率で防止する
- **SC-003**: 有効な認証情報を持つユーザーの95%が最初の試行でアカウントを作成し、トップページに到達することに成功する
- **SC-004**: システムはエラーや大幅なパフォーマンス低下なしに、少なくとも100件の同時サインアップリクエストを処理する
- **SC-005**: パスワード検証は、アカウント作成前に最小要件を満たさないパスワードの100%を検出する
- **SC-006**: すべての成功したサインアップは、適切なリンクを持つ正確に1つのユーザーレコードと1つのワークスペースレコードを作成する
- **SC-007**: 作成されたすべてのワークスペースは、ユーザー指定の名前が正しく保存および表示される
- **SC-008**: データベース制約は、レースコンディション下（同時サインアップ）でも重複メールエントリを防止する

## 前提条件

- ユーザーはWebブラウザを通じてサインアップページにアクセスする
- メールアドレスはユーザーアカウントの一意の識別子として使用される
- メールアドレスは大文字小文字を区別しない（test@example.com = Test@Example.com = TEST@EXAMPLE.COM）
- デフォルトのパスワード要件は最小8文字（複雑性要件は後で拡張可能）
- 各ユーザーはデフォルトで独自のワークスペースを取得する; ワークスペース共有/コラボレーション機能はこの機能の範囲外
- ログイン状態を維持するためにセッションベース認証を使用
- "トップページ" はログイン後のアプリケーションのメインダッシュボードまたはホームページを指す
- この初期実装ではメール確認は不要（後で追加可能）
- システムは標準のWebフォーム検証パターンを使用する
- ユーザーはサインアップ中にワークスペース名を提供する（デフォルト名なし）
- レート制限とボット防止メカニズムはインフラストラクチャレベルで処理される
- ワークスペース名には特殊文字や絵文字を含む任意の文字を含めることができる
- ワークスペース名に一意性制約はない（複数のワークスペースが同じ名前を持つことが可能）

## スコープ外

- メール確認ワークフロー
- パスワードリセット機能
- ソーシャルログインオプション（Google、Facebookなど）
- サインアップ中のユーザープロフィールカスタマイズ
- 多要素認証（MFA）
- アカウント有効化/無効化ワークフロー
- チームサインアップまたはワークスペース招待フロー
- 最小長を超えるカスタムパスワード複雑性要件
- Remember me 機能
- 利用規約同意ワークフロー
- ワークスペース名の一意性検証
- ワークスペース名の長さ制限（255文字未満などの妥当な範囲を想定）

## 関連ドキュメント

- **UI仕様**: [S-100: サインアップページ](../../03-ui-spec/screens/S-100-signup.md)
- **API仕様**: [POST /auth/signup](../../05-api-reference/rest/auth/POST-signup.md)
- **データモデル**: [User Domain Model](../data-contracts/user-domain-model.md)
- **データベース**: [テーブル定義](../../04-system-design/backend/database/tables.md)
