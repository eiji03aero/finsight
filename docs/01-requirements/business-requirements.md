# ビジネス要件

## 機能要件

### ワークスペース管理機能

#### ワークスペース作成

- ユーザー登録時に、自動的にデフォルトのワークスペースが作成される
- ユーザーは追加のワークスペースを作成できる
- ワークスペース作成時には名前を設定する

#### ワークスペース選択・切り替え

- ユーザーは自分が所属する複数のワークスペース間で切り替えができる
- 現在選択中のワークスペースが明確に表示される
- すべてのデータ操作は、選択中のワークスペースに対して実行される

#### ワークスペース設定管理

- ワークスペース名を変更できる
- ワークスペースオーナーはワークスペースを削除できる
- ワークスペース削除時には、関連するすべてのデータも削除される

### ユーザー管理機能

#### ユーザー登録

- ユーザーはメールアドレスとパスワードでアカウントを作成できる
- メール認証は不要
- パスワードは安全に暗号化して保存する

#### ログイン・ログアウト

- ユーザーはメールアドレスとパスワードでログインできる
- セッション管理により、ログイン状態を維持する
- ログアウト機能を提供する

#### パスワード管理

- ユーザーはパスワードをリセットできる
- パスワード変更機能を提供する

### データ登録機能

#### CSV アップロード

- ワークスペースに対して任意のフォーマットの CSV ファイルをアップロードできる
- CSV テンプレート機能により、列とデータ項目のマッピングを設定できる
- テンプレートはワークスペース単位で保存・再利用が可能
- アップロード時にテンプレートを選択して適用できる

#### 手動データ入力

- ワークスペースに対してフォーム画面から収支データを 1 件ずつ入力できる
- 入力項目は以下を含む：
  - 日付
  - 金額
  - 収入/支出の区分
  - カテゴリ（マスタから選択）
  - メモ（任意）

#### データ編集・削除

- 登録済みの収支データを編集できる
- 登録済みの収支データを削除できる
- 編集・削除時には確認ダイアログを表示する

### マスタ管理機能

#### カテゴリマスタ管理

- ワークスペース単位でカテゴリの新規作成、編集、削除ができる
- カテゴリ名を設定できる
- カテゴリは収入用と支出用を区別できる
- カテゴリはワークスペースメンバー間で共有される

#### 繰り返しトランザクション管理

- 定期的に発生する収支データを登録できる
- 繰り返しトランザクションには以下の情報を含む：
  - 開始日（必須）
  - 終了日（任意、指定しない場合は無期限）
  - 日付（取引日）
  - 金額
  - 収入/支出の区分
  - カテゴリ（マスタから選択）
  - メモ（任意）
- 繰り返しトランザクションの編集、削除ができる
- 既存の繰り返しトランザクションをコピーして新しい繰り返しトランザクションを作成できる

#### CSV テンプレート管理

- CSV の列マッピング設定を作成・保存できる
- 以下のマッピングを設定できる：
  - 日付列の指定と日付フォーマット
  - 金額列の指定
  - 収入/支出区分列の指定（または固定値設定）
  - カテゴリ列の指定（または手動割り当て）
  - その他の項目列の指定
- テンプレートに名前を付けて管理できる

#### マスタの自動・手動紐付け

- 収支データに対して、カテゴリマスタを手動で紐付けられる
- 将来的に自動紐付けのルールを設定できる仕組みを考慮した設計とする

### レポート作成機能

#### 月別収支テーブル

- 月ごとの収支をテーブル形式で表示する
- 表示項目をカスタマイズできる（カテゴリ別など）
- 各項目をクリックすると、ドリルダウンして内訳の詳細テーブルを表示する
- 内訳テーブルには個別の収支データを表示する
- 繰り返しトランザクションと変動費を分けて表示できる

#### 月別推移グラフ

- 指定した集計項目の月別推移を折れ線グラフで表示する
- 表示する集計項目をカスタマイズできる（例：総支出、カテゴリ別支出、収入など）
- 複数の項目を同時に表示できる
- グラフは視覚的にわかりやすいデザインとする

#### 期間フィルタリング

- レポート表示時に期間を指定できる
- 開始年月と終了年月を選択できる
- フィルタ適用後、テーブルとグラフが更新される

#### レポート設定の保存

- カスタマイズしたレポート設定（表示項目、期間など）を保存できる
- 保存したレポート設定を呼び出して再利用できる

## 想定されるユースケース

### 初回利用時

1. ユーザーがアカウントを作成する（自動的にデフォルトのワークスペースが作成される）
2. ワークスペースにカテゴリマスタを設定する
3. CSV テンプレートを作成する（または手動入力のみ使用）
4. 過去の家計簿データを CSV でアップロードする、または手動で入力する
5. レポート画面で収支状況を確認する

### 日常的な利用

1. ユーザーがログインする
2. 必要に応じてワークスペースを選択・切り替える
3. 新しい収支データを CSV でアップロード、または手動で入力する
4. 必要に応じてデータを編集・削除する
5. レポート画面で収支状況を確認する
6. 必要に応じて繰り返しトランザクションを登録・更新する

### 月次分析

1. ユーザーがログインする
2. 分析対象のワークスペースを選択する
3. レポート画面で前月の収支を確認する
4. カテゴリ別の支出をドリルダウンして詳細を確認する
5. 月別推移グラフで傾向を分析する
6. 必要に応じてカテゴリの割り当てを修正する

### 家計共有（複数人利用）

1. ワークスペースオーナーが家計管理用のワークスペースを作成する
2. オーナーが家族メンバーを招待する
3. 各メンバーがそれぞれ収支データを入力する
4. すべてのメンバーがワークスペース内のデータを閲覧・編集できる
5. メンバー全員で家計の分析やレポート確認を行う
